name: DEBUG - Testar Secrets

on:
  workflow_dispatch

permissions:
  contents: read

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: Test Secrets Connection
        env:
          EMAIL_SENDER: ${{ secrets.EMAIL_SENDER }}
          EMAIL_PASSWORD: ${{ secrets.EMAIL_PASSWORD }}
          EMAIL_RECIPIENT: ${{ secrets.EMAIL_RECIPIENT }}
        run: |
          python -c "
          import os
          print('üìã VERIFICANDO SECRETS:')
          sender = os.getenv('EMAIL_SENDER', '').strip()
          password = os.getenv('EMAIL_PASSWORD', '').strip()
          recipient = os.getenv('EMAIL_RECIPIENT', '').strip()
          
          print(f'  EMAIL_SENDER: {\"‚úÖ\" if sender else \"‚ùå\"} ({sender[:20] if sender else \"vazio\"})')
          print(f'  EMAIL_PASSWORD: {\"‚úÖ\" if password else \"‚ùå\"} (\"***\")')
          print(f'  EMAIL_RECIPIENT: {\"‚úÖ\" if recipient else \"‚ùå\"} ({recipient if recipient else \"vazio\"})')
          
          if not all([sender, password, recipient]):
              print('\\n‚ùå FALTAM SECRETS')
              exit(1)
          
          print('\\n‚úÖ TODOS OS SECRETS EST√ÉO CONFIGURADOS')
          "
      
      - name: Test monitor.py syntax
        run: |
          python -m py_compile monitor.py
          echo "‚úÖ monitor.py - Sintaxe OK"
      
      - name: Test imports
        run: |
          pip install -q yfinance pandas requests
          python -c "import yfinance; import pandas; print('‚úÖ Depend√™ncias OK')"
